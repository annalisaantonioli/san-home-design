{% if linklists.gift-wrapping.links.size > 0 and linklists.gift-wrapping.links.first.type == 'product_link' %}
  <div id="is-a-gift" class="clearfix rte">
    {% for item in linklists.gift-wrapping.links %}
      {% assign variant = item.object %}
    <p>
      <input type="hidden" name="attributes[gift-wrapping]" data-variantId="{{ variant.id }}" value="" />
      <input id="gift-wrapping" type="checkbox" name="attributes[gift-wrapping]" data-variantId="{{ variant.id }}" value="yes" {% for item in cart.items %}{% if item.id == variant.id %} checked="checked"{% endif %}{% endfor %} style="float: none" />
      {{ variant.image.src }}
      <label for="gift-wrapping" style="display:inline; padding-left: 5px; float: none;">
        <span class="shd-uppercase shd-font-semibold">{{ item.title }} - {{ item.object.price | money }}</span>
        <span class="shd-block shd-mt-8">{{ item.object.description }}</span>
      </label>
    </p>
    {% endfor %}
  </div>

{% assign id = item.object.variants.first.id %}

{% assign gift_wraps_in_cart = 0 %}
{% for item in cart.items %}
  {% if item.id == id %}
    {% assign gift_wraps_in_cart = item.quantity %}
  {% endif %}
{% endfor %}

<style>
  #updates_{{ id }} { display: none; }
</style>

<script>

var variantList = [],
    giftObj = {};

{% for item in linklists.gift-wrapping.links %}
    variantList.push({{item.object.id}});
{% endfor %}
console.log('variant list', variantList)
Shopify.Cart = Shopify.Cart || {};

Shopify.Cart.GiftWrap = {};

Shopify.Cart.GiftWrap.set = function(obj, selectedItem) {
  console.log('ojb', obj)
  console.log('selected item', selectedItem)
    var headers = new Headers({ 'Content-Type': 'application/json' });
      var request = {
      method: 'POST',
      headers: headers,
      body: JSON.stringify({ updates: obj  })
    };
   /* fetch('/cart/update.js', request)
    .then(function() {
      location.href = '/cart';
    });*/

}

Shopify.Cart.GiftWrap.remove = function(obj) {

    var headers = new Headers({ 'Content-Type': 'application/json' });
      var request = {
      method: 'POST',
      headers: headers,
      body: JSON.stringify({ updates: obj  })
    };
    fetch('/cart/update.js', request)
    .then(function() {
      location.href = '/cart';
    });
}

{% if cart.items.size == 1 and gift_wraps_in_cart > 0 %}
    document.addEventListener("DOMContentLoaded", function(){
      console.log('condizione di remove')
       Shopify.Cart.GiftWrap.remove();
});
{% endif %}

// When the gift-wrapping checkbox is checked or unchecked.
    function createObjectQuntity(element, index, array, selectedItem) {
      if( element == selectedItem) {
        giftObj[element] = 1;
      } else {
        giftObj[element] = 0;
      }
      console.log('esegye createObgQnt', element)
    }
    document.addEventListener("DOMContentLoaded", function(){
      const items = document.querySelectorAll('[name="attributes[gift-wrapping]"]')
      items.forEach(item => {(
            item.addEventListener("change", function() {
            var selectedItem = item.getAttribute("data-variantId");
              console.log('current sele', selectedItem)

    if (item.checked) {
      variantList.forEach(el => {
        if (el == selectedItem) {
          giftObj[el] = 1
        }
      });
      Shopify.Cart.GiftWrap.set(giftObj, selectedItem);
    }
    else {
     
          variantList.forEach(el => {
        if (el == selectedItem ) {
          giftObj[el] = 0
        }
      });
      Shopify.Cart.GiftWrap.remove(giftObj);
    }
              console.log('giftObej',giftObj)
  })
      )})


});

</script>

{% else %}

<p style="clear: left; margin: 30px 0" class="rte">
  You attempted to add a gift-wrapping script to your shopping cart, but it won't work because you don't have
  a link list with handle <code>gift-wrapping</code> which, in turn, contains a link
  to your gift-wrapping product. Please review the steps outlined
  <a href="http://docs.shopify.com/manual/configuration/store-customization/page-specific/cart-page/add-a-gift-wrap-option">here</a>.
</p>

{% endif %}