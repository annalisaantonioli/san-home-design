{% if linklists.gift-wrapping.links.size > 0 and
linklists.gift-wrapping.links.first.type == 'product_link' %}
  {% assign gift_wraps_in_cart = 0 %}
      {% assign ids= "" | split: ',' %}
  

  {% for item in linklists.gift-wrapping.links %}
    {% assign theid = item.object.id | split: ',' %}
      {% assign ids = ids | concat: theid %}
  
    

<div
  id="is-a-gift-{{ item.object.id }}"
  style="clear: left; margin: 30px 0"
  class="clearfix rte"
>
    {% assign name = 'gift-wrapping-' | append: item.object.variants.first.id %}
  
    {% assign checked = false  %}
     {% for el in cart.attributes %}
       ----{{ el }}----
      {% if el == name and el == 'true' %}
        {% assign checked = true %}
        {% endif %}
  {% endfor %}
  
  <p class="shd-checkbox-custom">
    <input
      id="gift-wrapping-{{ item.object.variants.first.id }}"
      data-id="{{ item.object.variants.first.id }}"
      type="checkbox"
      name="attributes[gift-wrapping]"
      value="yes"
    
     {% if checked %}
      checked="checked"
      {% endif %}
      style="float: none"
    />
    <span class="checkmark"></span>
    <label
      for="gift-wrapping"
      style="display:inline; padding-left: 5px; float: none;"
    >
      <span class="shd-uppercase shd-font-semibold">{{ item.title }} - {{ item.object.price | money }}</span>
     
      <span class="shd-block shd-mt-8">{{ item.object.description }}</span>
    </label>
  </p>
  
 
   

</div>



{% endfor %}
      {% assign id_1 = linklists.gift-wrapping.links.first.object.variants.first.id %} 
     {% assign id_2 = linklists.gift-wrapping.links.last.object.variants.first.id %} 
 
{% assign name_1 = 'gift-wrapping-' | append: id_1 %}
  {% assign name_2 = 'gift-wrapping-' | append: id_1 %}

{% for item in cart.items %} {% if
item.id == id_1 or item.id == id_2 %} {% assign gift_wraps_in_cart =  gift_wraps_in_cart| plus: item.quantity %} {% endif %}
{% endfor %}
  count {{ gift_wraps_in_cart }}
<style>
  #updates_{{ id_1 }} { display: none; }
    #updates_{{ id_2 }} { display: none; }
</style>

<script>

  Shopify.Cart = Shopify.Cart || {};

  Shopify.Cart.GiftWrap = {};

  Shopify.Cart.GiftWrap.set = function(el) {
    var headers = new Headers({ 'Content-Type': 'application/json' });
    const items = document.querySelectorAll('[name="attributes[gift-wrapping]"]')
    const content = {}
    const attrs = {}
    items.forEach((item, i) => {
      const el = {}

      content[item.dataset.id] = item.checked ? 1 : 0
      
      attrs[item.id] =  item.checked ? 'yes' : ''
   
      
    })

    
    var request = {
      method: 'POST',
      headers: headers,
      body: JSON.stringify({ updates: content, attributes: attrs })
    };
    fetch('/cart/update.js', request)
    .then(function() {
      location.href = '/cart';
    });
  }

  Shopify.Cart.GiftWrap.remove = function(el) {
    var headers = new Headers({ 'Content-Type': 'application/json' });
     const items = document.querySelectorAll('[name="attributes[gift-wrapping]"]')
     const content = {}
    const attrs = {}
    items.forEach((item, i) => {
      const el = {}

      content[item.dataset.id] = item.checked ? 1 : 0
      
      attrs[item.id] =  item.checked ? 'yes': ''
   
      
    })

    var request = {
      method: 'POST',
      headers: headers,
      body: JSON.stringify({ updates: content, attributes: attrs })
    };
  fetch('/cart/update.js', request)
    .then(function() {
      location.href = '/cart';
    });
  }



  // If we have nothing but gift-wrap items in the cart.
  {% if cart.items.size == 1 and gift_wraps_in_cart > 0 %}
    
  document.addEventListener("DOMContentLoaded", function(){
    Shopify.Cart.GiftWrap.remove();
    
  });
  // If we have more than one gift-wrap item in the cart.
  {% elsif gift_wraps_in_cart > 1 %}
  document.addEventListener("DOMContentLoaded", function(){
     Shopify.Cart.GiftWrap.set();

  });
  // If we have a gift-wrap item in the cart but our gift-wrapping cart attribute has not been set.
  {% elsif gift_wraps_in_cart > 0 and cart.attributes.gift-wrapping == blank  %}
  document.addEventListener("DOMContentLoaded", function(){
    Shopify.Cart.GiftWrap.set();
  });
  // If we have no gift-wrap item in the cart but our gift-wrapping cart attribute has been set.
{% elsif gift_wraps_in_cart == 0 and cart.attributes.gift-wrapping-id_1 != blank or gift_wraps_in_cart == 0 and cart.attributes.gift-wrapping-id_2 != blank %}
  document.addEventListener("DOMContentLoaded", function(){
     Shopify.Cart.GiftWrap.set();
  Ã¬
  });
    {% elsif gift_wraps_in_cart == 0 and cart.attributes.gift-wrapping-id_2 != blank %}
  document.addEventListener("DOMContentLoaded", function(){
   
       Shopify.Cart.GiftWrap.set();
  });
  {% endif %}

  // When the gift-wrapping checkbox is checked or unchecked.
  document.addEventListener("DOMContentLoaded", function(){
    const itemsChdk =  document.querySelectorAll('[name="attributes[gift-wrapping]"]')
 
   
  itemsChdk.forEach(item => {
    const id = item.id
    item.addEventListener("change", function(event) {
      if (event.target.checked) {
        Shopify.Cart.GiftWrap.set();
        

      } else {
        Shopify.Cart.GiftWrap.remove();
       
      }
  })
  })
   /* document.querySelector('#gift-note').addEventListener("change", function(evt) {
      var note = evt.target.value;
      var headers = new Headers({ 'Content-Type': 'application/json' });

      var request = {
        method: 'POST',
        headers: headers,
        body: JSON.stringify({ attributes: { 'gift-note': note } })
      };

      fetch('/cart/update.js', request);
    });*/
  });


</script>

{% else %}

<p style="clear: left; margin: 30px 0" class="rte">
  You attempted to add a gift-wrapping script to your shopping cart, but it
  won't work because you don't have a link list with handle
  <code>gift-wrapping</code> which, in turn, contains a link to your
  gift-wrapping product. Please review the steps outlined
  <a
    href="https://help.shopify.com/manual/online-store/themes/os/customize/add-gift-wrap-option"
    target="_blank"
    rel="noopener noreferrer nofollow"
    >here</a
  >.
</p>

{% endif %}

